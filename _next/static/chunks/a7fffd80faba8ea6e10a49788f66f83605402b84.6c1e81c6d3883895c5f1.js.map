{"version":3,"sources":["webpack://_N_E/./dedup/playlist-cache.ts","webpack://_N_E/./node_modules/react-i18next/dist/es/Trans.js","webpack://_N_E/./components/panel.tsx","webpack://_N_E/./node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","webpack://_N_E/./dedup/library.ts","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://_N_E/./dedup/promiseForPages.ts","webpack://_N_E/./node_modules/void-elements/index.js","webpack://_N_E/./node_modules/@babel/runtime/helpers/objectWithoutProperties.js","webpack://_N_E/./components/badge.tsx","webpack://_N_E/./node_modules/html-parse-stringify2/lib/stringify.js","webpack://_N_E/./components/bmc.tsx","webpack://_N_E/./node_modules/@babel/runtime/helpers/typeof.js","webpack://_N_E/./node_modules/react-i18next/dist/es/Translation.js","webpack://_N_E/./components/main.tsx","webpack://_N_E/./node_modules/html-parse-stringify2/lib/parse.js","webpack://_N_E/./dedup/process.ts","webpack://_N_E/./node_modules/@babel/runtime/regenerator/index.js","webpack://_N_E/./dedup/deduplicator.ts","webpack://_N_E/./node_modules/html-parse-stringify2/index.js","webpack://_N_E/./node_modules/html-parse-stringify2/lib/parse-tag.js"],"names":["PlaylistCache","playlist","localStorage","getItem","snapshot_id","e","setItem","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","hasChildren","node","checkLength","base","props","children","getChildren","getAsArray","data","Array","isArray","renderNodes","targetString","i18n","i18nOptions","combinedTOpts","keepArray","transKeepBasicHtmlNodesFor","emptyChildrenButNeedsHandling","RegExp","join","test","getData","childs","child","isValidElement","assign","interpolatedString","services","interpolator","interpolate","language","ast","parse","concat","renderInner","rootReactNode","mappedChildren","mapAST","prototype","toString","call","every","hasValidReactChildren","pushTranslatedJSX","inner","mem","dummy","cloneElement","reactNode","astNode","reactNodes","reduce","translationContent","content","type","tmp","parseInt","name","attrs","newTarget","mergeProps","isElement","isValidTranslationWithChildren","voidElement","isEmptyTransWithHTML","isKnownComponent","hasOwnProperty","_inner","Number","isNaN","parseFloat","transSupportBasicHtmlNodes","indexOf","createElement","_inner3","_inner4","Trans","_ref","count","parent","i18nKey","tOptions","values","defaults","components","ns","i18nFromProps","tFromProps","t","additionalProps","_ref2","i18nFromContext","defaultNSFromContext","defaultNS","bind","k","reactI18nextOptions","options","react","namespaces","defaultValue","nodesToString","stringNode","childrenArray","childIndex","childPropsCount","shouldKeepChild","childChildren","i18nIsDynamicList","format","clone","value","transEmptyNodeValue","hashTransKey","interpolation","prefix","suffix","useAsParent","undefined","defaultTransParent","module","exports","excluded","sourceKeys","fetchUserOwnedPlaylists","api","userId","a","promisesForPages","getUserPlaylists","limit","pages","array","currentPage","items","owner","id","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","err","_arrayLikeToArray","arr","len","arr2","_toConsumableArray","iter","Symbol","iterator","from","o","minLen","n","slice","constructor","TypeError","stripParameters","href","substr","fetchGeneric","offset","getGeneric","fetchPageWithDefaults","result","fill","initialRequest","results","total","promises","Math","ceil","prev","_","currentIndex","promise","func","console","objectWithoutPropertiesLoose","sourceSymbolKeys","propertyIsEnumerable","stringify","buff","doc","attrString","token","rootEl","useTranslation","style","paddingTop","onClick","global","src","width","height","alt","marginLeft","_typeof","obj","Translation","_useTranslation","_useTranslation2","ready","lng","DuplicateTrackList","DuplicateTrackListItem","reason","trackName","trackArtistName","Status","toProcess","Main","playlists","savedTracks","status","duplicates","index","state","findIndex","p","playlistModel","collaborative","PlaylistDeduplicator","removeDuplicates","playlistsCopy","log","setState","captureMessage","extra","process","Process","on","user","SavedTracksDeduplicator","totalDuplicates","current","dangerouslySetInnerHTML","__html","strongOpen","strongClose","removeDuplicatesInSavedTracks","map","duplicate","track","artists","images","url","React","Component","tagRE","parseTag","empty","create","pushTextNode","list","html","level","start","ignoreWhitespace","end","byTag","inComponent","replace","tag","isOpen","charAt","isComment","nextChar","tagName","playlistCache","playlistToPlaylistModel","processed","onPlaylistProcessed","remaining","currentState","dispatch","playlistsToCheck","ownedPlaylists","getTracks","getMySavedTracks","findDuplicatedTracks","needsCheckForDuplicates","playlistTracks","storePlaylistWithoutDuplicates","listeners","event","params","callback","BaseDeduplicator","model","tracks","seenIds","seenNameAndArtist","isDuplicate","seenNameAndArtistKey","toLowerCase","duration","abs","duration_ms","pagePromises","all","page","item","tracksToRemove","d","uri","linked_from","positions","reverse","chunk","splice","removeTracksFromPlaylist","removeFromMySavedTracks","attrRE","voidElements","expectingValueAfterEquals","res","match"],"mappings":"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","file":"static/chunks/a7fffd80faba8ea6e10a49788f66f83605402b84.6c1e81c6d3883895c5f1.js","sourcesContent":["import { SpotifyPlaylistType } from './spotify-api';\nconst SNAPSHOT_VERSION = 'v1';\nexport default class PlaylistCache {\n  needsCheckForDuplicates(playlist: SpotifyPlaylistType) {\n    if ('snapshot_id' in playlist) {\n      try {\n        if (localStorage.getItem(playlist.snapshot_id) === SNAPSHOT_VERSION) {\n          return false;\n        }\n      } catch (e) {\n        return true;\n      }\n    }\n    return true;\n  }\n\n  storePlaylistWithoutDuplicates(playlist: SpotifyPlaylistType) {\n    if ('snapshot_id' in playlist) {\n      try {\n        localStorage.setItem(playlist.snapshot_id, SNAPSHOT_VERSION);\n      } catch (e) {}\n    }\n  }\n}\n","import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useContext } from 'react';\nimport HTML from 'html-parse-stringify2';\nimport { getI18n, I18nContext, getDefaults } from './context';\nimport { warn, warnOnce } from './utils';\n\nfunction hasChildren(node, checkLength) {\n  if (!node) return false;\n  var base = node.props ? node.props.children : node.children;\n  if (checkLength) return base.length > 0;\n  return !!base;\n}\n\nfunction getChildren(node) {\n  if (!node) return [];\n  return node && node.children ? node.children : node.props && node.props.children;\n}\n\nfunction hasValidReactChildren(children) {\n  if (Object.prototype.toString.call(children) !== '[object Array]') return false;\n  return children.every(function (child) {\n    return React.isValidElement(child);\n  });\n}\n\nfunction getAsArray(data) {\n  return Array.isArray(data) ? data : [data];\n}\n\nfunction mergeProps(source, target) {\n  var newTarget = _objectSpread({}, target);\n\n  newTarget.props = Object.assign(source.props, target.props);\n  return newTarget;\n}\n\nexport function nodesToString(children, i18nOptions) {\n  if (!children) return '';\n  var stringNode = '';\n  var childrenArray = getAsArray(children);\n  var keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  childrenArray.forEach(function (child, childIndex) {\n    if (typeof child === 'string') {\n      stringNode += \"\".concat(child);\n    } else if (React.isValidElement(child)) {\n      var childPropsCount = Object.keys(child.props).length;\n      var shouldKeepChild = keepArray.indexOf(child.type) > -1;\n      var childChildren = child.props.children;\n\n      if (!childChildren && shouldKeepChild && childPropsCount === 0) {\n        stringNode += \"<\".concat(child.type, \"/>\");\n      } else if (!childChildren && (!shouldKeepChild || childPropsCount !== 0)) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (child.props.i18nIsDynamicList) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (shouldKeepChild && childPropsCount === 1 && typeof childChildren === 'string') {\n        stringNode += \"<\".concat(child.type, \">\").concat(childChildren, \"</\").concat(child.type, \">\");\n      } else {\n        var content = nodesToString(childChildren, i18nOptions);\n        stringNode += \"<\".concat(childIndex, \">\").concat(content, \"</\").concat(childIndex, \">\");\n      }\n    } else if (_typeof(child) === 'object') {\n      var format = child.format,\n          clone = _objectWithoutProperties(child, [\"format\"]);\n\n      var keys = Object.keys(clone);\n\n      if (keys.length === 1) {\n        var value = format ? \"\".concat(keys[0], \", \").concat(format) : keys[0];\n        stringNode += \"{{\".concat(value, \"}}\");\n      } else {\n        warn(\"react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.\", child);\n      }\n    } else {\n      warn(\"Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.\", child);\n    }\n  });\n  return stringNode;\n}\n\nfunction renderNodes(children, targetString, i18n, i18nOptions, combinedTOpts) {\n  if (targetString === '') return [];\n  var keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  var emptyChildrenButNeedsHandling = targetString && new RegExp(keepArray.join('|')).test(targetString);\n  if (!children && !emptyChildrenButNeedsHandling) return [targetString];\n  var data = {};\n\n  function getData(childs) {\n    var childrenArray = getAsArray(childs);\n    childrenArray.forEach(function (child) {\n      if (typeof child === 'string') return;\n      if (hasChildren(child)) getData(getChildren(child));else if (_typeof(child) === 'object' && !React.isValidElement(child)) Object.assign(data, child);\n    });\n  }\n\n  getData(children);\n  var interpolatedString = i18n.services.interpolator.interpolate(targetString, _objectSpread({}, data, {}, combinedTOpts), i18n.language);\n  var ast = HTML.parse(\"<0>\".concat(interpolatedString, \"</0>\"));\n\n  function renderInner(child, node, rootReactNode) {\n    var childs = getChildren(child);\n    var mappedChildren = mapAST(childs, node.children, rootReactNode);\n    return hasValidReactChildren(childs) && mappedChildren.length === 0 ? childs : mappedChildren;\n  }\n\n  function pushTranslatedJSX(child, inner, mem, i) {\n    if (child.dummy) child.children = inner;\n    mem.push(React.cloneElement(child, _objectSpread({}, child.props, {\n      key: i\n    }), inner));\n  }\n\n  function mapAST(reactNode, astNode, rootReactNode) {\n    var reactNodes = getAsArray(reactNode);\n    var astNodes = getAsArray(astNode);\n    return astNodes.reduce(function (mem, node, i) {\n      var translationContent = node.children && node.children[0] && node.children[0].content;\n\n      if (node.type === 'tag') {\n        var tmp = reactNodes[parseInt(node.name, 10)];\n        if (!tmp && rootReactNode.length === 1 && rootReactNode[0][node.name]) tmp = rootReactNode[0][node.name];\n        if (!tmp) tmp = {};\n        var child = Object.keys(node.attrs).length !== 0 ? mergeProps({\n          props: node.attrs\n        }, tmp) : tmp;\n        var isElement = React.isValidElement(child);\n        var isValidTranslationWithChildren = isElement && hasChildren(node, true) && !node.voidElement;\n        var isEmptyTransWithHTML = emptyChildrenButNeedsHandling && _typeof(child) === 'object' && child.dummy && !isElement;\n        var isKnownComponent = _typeof(children) === 'object' && children !== null && Object.hasOwnProperty.call(children, node.name);\n\n        if (typeof child === 'string') {\n          mem.push(child);\n        } else if (hasChildren(child) || isValidTranslationWithChildren) {\n            var inner = renderInner(child, node, rootReactNode);\n            pushTranslatedJSX(child, inner, mem, i);\n          } else if (isEmptyTransWithHTML) {\n          var _inner = mapAST(reactNodes, node.children, rootReactNode);\n\n          mem.push(React.cloneElement(child, _objectSpread({}, child.props, {\n            key: i\n          }), _inner));\n        } else if (Number.isNaN(parseFloat(node.name))) {\n          if (isKnownComponent) {\n            var _inner2 = renderInner(child, node, rootReactNode);\n\n            pushTranslatedJSX(child, _inner2, mem, i);\n          } else if (i18nOptions.transSupportBasicHtmlNodes && keepArray.indexOf(node.name) > -1) {\n            if (node.voidElement) {\n              mem.push(React.createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }));\n            } else {\n              var _inner3 = mapAST(reactNodes, node.children, rootReactNode);\n\n              mem.push(React.createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }, _inner3));\n            }\n          } else if (node.voidElement) {\n            mem.push(\"<\".concat(node.name, \" />\"));\n          } else {\n            var _inner4 = mapAST(reactNodes, node.children, rootReactNode);\n\n            mem.push(\"<\".concat(node.name, \">\").concat(_inner4, \"</\").concat(node.name, \">\"));\n          }\n        } else if (_typeof(child) === 'object' && !isElement) {\n          var content = node.children[0] ? translationContent : null;\n          if (content) mem.push(content);\n        } else if (node.children.length === 1 && translationContent) {\n          mem.push(React.cloneElement(child, _objectSpread({}, child.props, {\n            key: i\n          }), translationContent));\n        } else {\n          mem.push(React.cloneElement(child, _objectSpread({}, child.props, {\n            key: i\n          })));\n        }\n      } else if (node.type === 'text') {\n        mem.push(node.content);\n      }\n\n      return mem;\n    }, []);\n  }\n\n  var result = mapAST([{\n    dummy: true,\n    children: children\n  }], ast, getAsArray(children || []));\n  return getChildren(result[0]);\n}\n\nexport function Trans(_ref) {\n  var children = _ref.children,\n      count = _ref.count,\n      parent = _ref.parent,\n      i18nKey = _ref.i18nKey,\n      tOptions = _ref.tOptions,\n      values = _ref.values,\n      defaults = _ref.defaults,\n      components = _ref.components,\n      ns = _ref.ns,\n      i18nFromProps = _ref.i18n,\n      tFromProps = _ref.t,\n      additionalProps = _objectWithoutProperties(_ref, [\"children\", \"count\", \"parent\", \"i18nKey\", \"tOptions\", \"values\", \"defaults\", \"components\", \"ns\", \"i18n\", \"t\"]);\n\n  var _ref2 = useContext(I18nContext) || {},\n      i18nFromContext = _ref2.i18n,\n      defaultNSFromContext = _ref2.defaultNS;\n\n  var i18n = i18nFromProps || i18nFromContext || getI18n();\n\n  if (!i18n) {\n    warnOnce('You will need pass in an i18next instance by using i18nextReactModule');\n    return children;\n  }\n\n  var t = tFromProps || i18n.t.bind(i18n) || function (k) {\n    return k;\n  };\n\n  var reactI18nextOptions = _objectSpread({}, getDefaults(), {}, i18n.options && i18n.options.react);\n\n  var namespaces = ns || t.ns || defaultNSFromContext || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  var defaultValue = defaults || nodesToString(children, reactI18nextOptions) || reactI18nextOptions.transEmptyNodeValue || i18nKey;\n  var hashTransKey = reactI18nextOptions.hashTransKey;\n  var key = i18nKey || (hashTransKey ? hashTransKey(defaultValue) : defaultValue);\n  var interpolationOverride = values ? {} : {\n    interpolation: {\n      prefix: '#$?',\n      suffix: '?$#'\n    }\n  };\n\n  var combinedTOpts = _objectSpread({}, tOptions, {\n    count: count\n  }, values, {}, interpolationOverride, {\n    defaultValue: defaultValue,\n    ns: namespaces\n  });\n\n  var translation = key ? t(key, combinedTOpts) : defaultValue;\n  var content = renderNodes(components || children, translation, i18n, reactI18nextOptions, combinedTOpts);\n  var useAsParent = parent !== undefined ? parent : reactI18nextOptions.defaultTransParent;\n  return useAsParent ? React.createElement(useAsParent, additionalProps, content) : content;\n}","import React from 'react';\n\nexport default (props: { children: React.ReactNode }) => (\n  <div className=\"panel\">\n    <div className=\"panel-body\">{props.children}</div>\n    <style jsx>\n      {`\n        .panel {\n          margin-bottom: 20px;\n          border: 1px solid var(--accent-color);\n          border-radius: 4px;\n        }\n\n        .panel-body {\n          padding: 15px;\n        }\n      `}\n    </style>\n  </div>\n);\n","function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutPropertiesLoose;","import promisesForPages from './promiseForPages';\n\nexport const fetchUserOwnedPlaylists = async (api, userId: String) => {\n  const pages = await promisesForPages(\n    api,\n    api.getUserPlaylists(userId, { limit: 50 })\n  );\n\n  return pages.reduce(\n    (array, currentPage) =>\n      array.concat(\n        currentPage.items.filter(\n          playlist => playlist && playlist.owner.id === userId\n        )\n      ),\n    []\n  );\n};\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import SpotifyWebApi from \"./spotify-api\";\n\nfunction stripParameters(href: string) {\n  return href.indexOf('?') !== -1 ? href.substr(0, href.indexOf('?')) : href;\n}\n\nasync function fetchGeneric(api, href: string, offset: number, limit: number) {\n  return api.getGeneric(\n    `${stripParameters(href)}?offset=${offset}&limit=${limit}`\n  );\n}\n\nasync function fetchPageWithDefaults(\n  api: SpotifyWebApi,\n  href: string,\n  offset: number,\n  limit: number\n) {\n  let result: { items: Array<any> };\n  try {\n    result = await fetchGeneric(api, href, offset, limit);\n  } catch (e) {\n    // todo: report this in the UI somehow\n    /* console.error(\n        `Error making request to fetch tracks from ${href} with offset ${offset} and limit ${limit}`,\n        e\n      );*/\n    result = { items: new Array(limit).fill(null) };\n  }\n  return result;\n}\n\nexport default async function promisesForPages(\n  api: SpotifyWebApi,\n  initialRequest\n): Promise<Array<any>> {\n  const results = await initialRequest;\n  if (results === null) {\n    return [];\n  }\n\n  const { limit, total, offset, href } = results;\n  if (total === 0) {\n    return Promise.resolve([]);\n  }\n  const promises = new Array(Math.ceil((total - limit - offset) / limit))\n    .fill('')\n    .reduce(\n      (prev, _, currentIndex) => {\n        prev.push(() =>\n          fetchPageWithDefaults(\n            api,\n            href,\n            limit + offset + currentIndex * limit,\n            limit\n          )\n        );\n        return prev;\n      },\n      [() => initialRequest]\n    );\n\n  return promises.reduce(\n    (promise, func) =>\n      promise\n        .then(result =>\n          func()\n            .then(Array.prototype.concat.bind(result))\n            .catch(e => {\n              console.error('There was an error reducing promises', e);\n            })\n        )\n        .catch(e => {\n          console.error(\n            'There was an error reducing promises - general catch',\n            e\n          );\n        }),\n    Promise.resolve([])\n  );\n}\n","/**\n * This file automatically generated from `pre-publish.js`.\n * Do not manually edit.\n */\n\nmodule.exports = {\n  \"area\": true,\n  \"base\": true,\n  \"br\": true,\n  \"col\": true,\n  \"embed\": true,\n  \"hr\": true,\n  \"img\": true,\n  \"input\": true,\n  \"keygen\": true,\n  \"link\": true,\n  \"menuitem\": true,\n  \"meta\": true,\n  \"param\": true,\n  \"source\": true,\n  \"track\": true,\n  \"wbr\": true\n};\n","var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose\");\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutProperties;","import React from 'react';\n\nexport default (props: { children: React.ReactNode }) => (\n  <span>\n    {props.children}\n    <style jsx>\n      {`\n        span {\n          display: inline-block;\n          min-width: 10px;\n          padding: 3px 7px;\n          font-size: 12px;\n          font-weight: 700;\n          line-height: 1;\n          color: #fff;\n          text-align: center;\n          white-space: nowrap;\n          vertical-align: baseline;\n          background-color: #999;\n          border-radius: 10px;\n          margin-right: 0.5em;\n        }\n      `}\n    </style>\n  </span>\n);\n","function attrString(attrs) {\n    var buff = [];\n    for (var key in attrs) {\n        buff.push(key + '=\"' + attrs[key] + '\"');\n    }\n    if (!buff.length) {\n        return '';\n    }\n    return ' ' + buff.join(' ');\n}\n\nfunction stringify(buff, doc) {\n    switch (doc.type) {\n    case 'text':\n        return buff + doc.content;\n    case 'tag':\n        buff += '<' + doc.name + (doc.attrs ? attrString(doc.attrs) : '') + (doc.voidElement ? '/>' : '>');\n        if (doc.voidElement) {\n            return buff;\n        }\n        return buff + doc.children.reduce(stringify, '') + '</' + doc.name + '>';\n    }\n}\n\nmodule.exports = function (doc) {\n    return doc.reduce(function (token, rootEl) {\n        return token + stringify('', rootEl);\n    }, '');\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport default () => {\n  const { t, i18n } = useTranslation();\n\n  return (\n    <div style={{ paddingTop: '1em' }}>\n      <a\n        className=\"bmc-button\"\n        target=\"_blank\"\n        href=\"https://www.buymeacoffee.com/jmp\"\n        onClick={() => {\n          global['fbq'] && global['fbq']('track', 'InitiateCheckout');\n          global['ga'] &&\n            global['ga']('send', 'event', 'spotify-dedup', 'bmc-clicked');\n        }}\n      >\n        <img\n          src=\"https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg\"\n          width=\"25\"\n          height=\"35\"\n          alt=\"\"\n        />\n        <span style={{ marginLeft: '5px' }}>{t('bmc.button')}</span>\n      </a>\n      <style jsx>\n        {`\n          .bmc-button {\n            line-height: 36px;\n            height: 37px;\n            text-decoration: none;\n            display: inline-flex;\n            color: #fff;\n            background-color: #ff813f;\n            border-radius: 3px;\n            border: 1px solid transparent;\n            padding: 0 9px;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { useTranslation } from './useTranslation';\nexport function Translation(props) {\n  var ns = props.ns,\n      children = props.children,\n      options = _objectWithoutProperties(props, [\"ns\", \"children\"]);\n\n  var _useTranslation = useTranslation(ns, options),\n      _useTranslation2 = _slicedToArray(_useTranslation, 3),\n      t = _useTranslation2[0],\n      i18n = _useTranslation2[1],\n      ready = _useTranslation2[2];\n\n  return children(t, {\n    i18n: i18n,\n    lng: i18n.language\n  }, ready);\n}","import React from 'react';\nimport { useTranslation, Trans, Translation } from 'react-i18next';\nimport { PlaylistModel } from '../dedup/types';\nimport { SpotifyUserType, SpotifyTrackType } from '../dedup/spotify-api';\n\nimport Process from '../dedup/process';\nimport {\n  PlaylistDeduplicator,\n  SavedTracksDeduplicator,\n} from '../dedup/deduplicator';\n\nimport Badge from './badge';\nimport BuyMeACoffee from './bmc';\nimport Panel from './panel';\n\n//todo: enforce that items are DuplicateTrackListItem\nexport const DuplicateTrackList = ({ children }) => (\n  <ul>\n    {children}\n    <style jsx>{`\n      ul {\n        padding: 0;\n      }\n    `}</style>\n  </ul>\n);\nexport const DuplicateTrackListItem = ({\n  reason,\n  trackName,\n  trackArtistName,\n}) => {\n  const { t, i18n } = useTranslation();\n  return (\n    <li>\n      {reason === 'same-id' && (\n        <Badge>{t('result.duplicate.reason-same-id')}</Badge>\n      )}\n      {reason === 'same-name-artist' && (\n        <Badge>{t('result.duplicate.reason-same-data')}</Badge>\n      )}\n      <Trans i18nKey=\"result.duplicate.track\">\n        <span>{{ trackName }}</span> <span className=\"gray\">by</span>{' '}\n        <span>{{ trackArtistName }}</span>\n      </Trans>\n      <style jsx>\n        {`\n          .gray {\n            color: #999;\n          }\n        `}\n      </style>\n    </li>\n  );\n};\n\nconst Status = ({ toProcess }) => {\n  const { t } = useTranslation();\n  return (\n    <span>\n      <h3>\n        {toProcess > 0 || toProcess === null\n          ? t('process.status.finding')\n          : t('process.status.complete')}\n      </h3>\n      <style jsx>\n        {`\n          h3 {\n            font-size: 24px;\n          }\n        `}\n      </style>\n    </span>\n  );\n};\n\ntype StateType = {\n  toProcess?: number;\n  playlists: Array<PlaylistModel>;\n  savedTracks: {\n    status?: string;\n    duplicates: Array<{\n      index: number;\n      reason: string;\n      track: SpotifyTrackType;\n    }>;\n  };\n};\n\nexport default class Main extends React.Component<{\n  api: any;\n  user: SpotifyUserType;\n}> {\n  state: StateType = {\n    toProcess: null,\n    playlists: [],\n    savedTracks: {\n      status: null,\n      duplicates: [],\n    },\n  };\n\n  componentWillUnmount() {\n    console.log('Main > componentWillUnmount');\n  }\n\n  componentDidCatch(error, info) {\n    console.log('Main > componentDidCatch', error, info);\n  }\n\n  componentDidMount() {\n    const process = new Process();\n    process.on('updateState', (state) => {\n      console.log('Main > componentDidMount > updating state', state);\n      this.setState(state);\n    });\n    process.process(this.props.api, this.props.user);\n  }\n\n  removeDuplicates = (playlist: PlaylistModel) => {\n    (async () => {\n      const index = this.state.playlists.findIndex(\n        (p) => p.playlist.id === playlist.playlist.id\n      );\n      const playlistModel = this.state.playlists[index];\n      if (playlistModel.playlist.id === 'starred') {\n        global['alert'] &&\n          global['alert'](\n            'It is not possible to delete duplicates from your Starred playlist using this tool since this is not supported in the Spotify Web API. You will need to remove these manually.'\n          );\n      }\n      if (playlistModel.playlist.collaborative) {\n        global['alert'] &&\n          global['alert'](\n            'It is not possible to delete duplicates from a collaborative playlist using this tool since this is not supported in the Spotify Web API. You will need to remove these manually.'\n          );\n      } else {\n        try {\n          await PlaylistDeduplicator.removeDuplicates(\n            this.props.api,\n            playlistModel\n          );\n          const playlistsCopy = [...this.state.playlists];\n          playlistsCopy[index].duplicates = [];\n          playlistsCopy[index].status = 'process.items.removed';\n          console.log('Main > removeDuplicates > updating state');\n          this.setState({ ...this.state, playlists: [...playlistsCopy] });\n          if (global['ga']) {\n            global['ga'](\n              'send',\n              'event',\n              'spotify-dedup',\n              'playlist-removed-duplicates'\n            );\n          }\n        } catch (e) {\n          global['Raven'] &&\n            global['Raven'].captureMessage(\n              `Exception trying to remove duplicates from playlist`,\n              {\n                extra: {\n                  duplicates: playlistModel.duplicates,\n                },\n              }\n            );\n        }\n      }\n    })();\n  };\n\n  removeDuplicatesInSavedTracks() {\n    (async () => {\n      await SavedTracksDeduplicator.removeDuplicates(\n        this.props.api,\n        this.state.savedTracks\n      );\n      console.log('Main > removeDuplicatesInSavedTracks > updating state');\n      this.setState({\n        ...this.state,\n        savedTracks: {\n          duplicates: [],\n          status: 'process.items.removed',\n        },\n      });\n      if (global['ga']) {\n        global['ga'](\n          'send',\n          'event',\n          'spotify-dedup',\n          'saved-tracks-removed-duplicates'\n        );\n      }\n    })();\n  }\n\n  render() {\n    const totalDuplicates =\n      this.state.playlists.length === 0\n        ? 0\n        : this.state.playlists.reduce(\n            (prev, current) => prev + current.duplicates.length,\n            0\n          ) + this.state.savedTracks.duplicates.length;\n    return (\n      <div>\n        <Status toProcess={this.state.toProcess} />\n        <Panel>\n          {this.state.toProcess === null && (\n            <Translation>{(t) => t('process.reading-library')}</Translation>\n          )}\n          {this.state.toProcess > 0 && (\n            <Translation>\n              {(t) => t('process.processing', { count: this.state.toProcess })}\n            </Translation>\n          )}\n          {this.state.toProcess === 0 && totalDuplicates > 0 && (\n            <span>\n              <Translation>\n                {(t) => t('process.status.complete.body')}\n              </Translation>{' '}\n              <Translation>\n                {(t) => (\n                  <span\n                    dangerouslySetInnerHTML={{\n                      __html: t('process.status.complete.dups.body', {\n                        strongOpen: '<strong>',\n                        strongClose: '</strong>',\n                      }),\n                    }}\n                  />\n                )}\n              </Translation>\n              <BuyMeACoffee />\n            </span>\n          )}\n          {this.state.toProcess === 0 && totalDuplicates === 0 && (\n            <span>\n              <Translation>\n                {(t) => t('process.status.complete.body')}\n              </Translation>\n              <br />\n              <Translation>\n                {(t) => t('process.status.complete.nodups.body')}\n              </Translation>\n              <BuyMeACoffee />\n            </span>\n          )}\n        </Panel>\n\n        <ul className=\"playlists-list\">\n          {(this.state.savedTracks.duplicates.length ||\n            this.state.savedTracks.status) && (\n            <li className=\"playlists-list-item media\">\n              <div className=\"img\">\n                <img\n                  width=\"100\"\n                  height=\"100\"\n                  className=\"playlists-list-item__img\"\n                  src={'./placeholder.png'}\n                />\n              </div>\n              <div className=\"bd\">\n                <span className=\"playlists-list-item__name\">\n                  <Translation>{(t) => t('process.saved.title')}</Translation>\n                </span>\n                {this.state.savedTracks.status && (\n                  <Badge>\n                    <Translation>\n                      {(t) => t(this.state.savedTracks.status)}\n                    </Translation>\n                  </Badge>\n                )}\n                {this.state.savedTracks.duplicates.length != 0 && (\n                  <span>\n                    <span>\n                      <Translation>\n                        {(t) =>\n                          t('process.saved.duplicates', {\n                            count: this.state.savedTracks.duplicates.length,\n                          })\n                        }\n                      </Translation>\n                    </span>\n                    <button\n                      className=\"btn btn-primary btn-sm playlist-list-item__btn\"\n                      onClick={() => this.removeDuplicatesInSavedTracks()}\n                    >\n                      <Translation>\n                        {(t) => t('process.saved.remove-button')}\n                      </Translation>\n                    </button>\n                    <DuplicateTrackList>\n                      {this.state.savedTracks.duplicates.map(\n                        (duplicate, index) => (\n                          <DuplicateTrackListItem\n                            key={index}\n                            reason={duplicate.reason}\n                            trackName={duplicate.track.name}\n                            trackArtistName={duplicate.track.artists[0].name}\n                          />\n                        )\n                      )}\n                    </DuplicateTrackList>\n                  </span>\n                )}\n              </div>\n            </li>\n          )}\n          {this.state.playlists\n            .filter((p) => p.duplicates.length || p.status != '')\n            .map((playlist: PlaylistModel, index) => (\n              <li className=\"playlists-list-item media\" key={index}>\n                <div className=\"img\">\n                  <img\n                    width=\"100\"\n                    height=\"100\"\n                    className=\"playlists-list-item__img\"\n                    src={\n                      playlist.playlist.images &&\n                      playlist.playlist.images[0] &&\n                      playlist.playlist.images[0].url\n                    }\n                  />\n                </div>\n                <div className=\"bd\">\n                  <span className=\"playlists-list-item__name\">\n                    {playlist.playlist.name}\n                  </span>\n                  {playlist.status && (\n                    <Badge>\n                      <Translation>{(t) => t(playlist.status)}</Translation>\n                    </Badge>\n                  )}\n                  {playlist.duplicates.length != 0 && (\n                    <span>\n                      <span>\n                        <Translation>\n                          {(t) =>\n                            t('process.playlist.duplicates', {\n                              count: playlist.duplicates.length,\n                            })\n                          }\n                        </Translation>\n                      </span>\n                      <button\n                        className=\"btn btn-primary btn-sm playlist-list-item__btn\"\n                        onClick={() => this.removeDuplicates(playlist)}\n                      >\n                        <Translation>\n                          {(t) => t('process.playlist.remove-button')}\n                        </Translation>\n                      </button>\n                      <DuplicateTrackList>\n                        {playlist.duplicates.map((duplicate, index) => (\n                          <DuplicateTrackListItem\n                            key={index}\n                            reason={duplicate.reason}\n                            trackName={duplicate.track.name}\n                            trackArtistName={duplicate.track.artists[0].name}\n                          />\n                        ))}\n                      </DuplicateTrackList>\n                    </span>\n                  )}\n                </div>\n              </li>\n            ))}\n        </ul>\n        <style jsx>\n          {`\n            .bd {\n              position: relative;\n            }\n\n            .media,\n            .bd {\n              overflow: hidden;\n              _overflow: visible;\n              zoom: 1;\n            }\n\n            .media .img {\n              float: left;\n              margin-right: 20px;\n            }\n\n            img {\n              vertical-align: middle;\n            }\n\n            .playlists-list-item {\n              margin-bottom: 2rem;\n            }\n\n            .playlists-list-item__img {\n              width: 100px;\n            }\n\n            .btn {\n              display: inline-block;\n              padding: 6px 12px;\n              margin-bottom: 0;\n              font-size: 14px;\n              font-weight: 400;\n              line-height: 1.428571429;\n              text-align: center;\n              white-space: nowrap;\n              vertical-align: middle;\n              background-image: none;\n              border: 1px solid transparent;\n              border-radius: 4px;\n              cursor: pointer;\n            }\n\n            .btn-primary {\n              color: #fff;\n              background-color: #428bca;\n              border-color: #357ebd;\n            }\n\n            .btn-primary:hover {\n              background-color: #5094ce;\n            }\n\n            .playlist-list-item__btn {\n              max-width: 50%;\n              position: absolute;\n              right: 0;\n              top: 0;\n            }\n\n            @media (max-width: 700px) {\n              .playlist-list-item__btn {\n                position: relative;\n                max-width: 100%;\n              }\n            }\n\n            .playlists-list-item__name {\n              display: block;\n              font-weight: bold;\n              max-width: 50%;\n            }\n\n            ul {\n              padding: 0;\n            }\n          `}\n        </style>\n      </div>\n    );\n  }\n}\n","/*jshint -W030 */\nvar tagRE = /(?:<!--[\\S\\s]*?-->|<(?:\"[^\"]*\"['\"]*|'[^']*'['\"]*|[^'\">])+>)/g;\nvar parseTag = require('./parse-tag');\n// re-used obj for quick lookups of components\nvar empty = Object.create ? Object.create(null) : {};\n// common logic for pushing a child node onto a list\nfunction pushTextNode(list, html, level, start, ignoreWhitespace) {\n    // calculate correct end of the content slice in case there's\n    // no tag after the text node.\n    var end = html.indexOf('<', start);\n    var content = html.slice(start, end === -1 ? undefined : end);\n    // if a node is nothing but whitespace, collapse it as the spec states:\n    // https://www.w3.org/TR/html4/struct/text.html#h-9.1\n    if (/^\\s*$/.test(content)) {\n        content = ' ';\n    }\n    // don't add whitespace-only text nodes if they would be trailing text nodes\n    // or if they would be leading whitespace-only text nodes:\n    //  * end > -1 indicates this is not a trailing text node\n    //  * leading node is when level is -1 and list has length 0\n    if ((!ignoreWhitespace && end > -1 && level + list.length >= 0) || content !== ' ') {\n        list.push({\n            type: 'text',\n            content: content\n        });\n    }\n}\n\nmodule.exports = function parse(html, options) {\n    options || (options = {});\n    options.components || (options.components = empty);\n    var result = [];\n    var current;\n    var level = -1;\n    var arr = [];\n    var byTag = {};\n    var inComponent = false;\n\n    html.replace(tagRE, function (tag, index) {\n        if (inComponent) {\n            if (tag !== ('</' + current.name + '>')) {\n                return;\n            } else {\n                inComponent = false;\n            }\n        }\n\n        var isOpen = tag.charAt(1) !== '/';\n        var isComment = tag.indexOf('<!--') === 0;\n        var start = index + tag.length;\n        var nextChar = html.charAt(start);\n        var parent;\n\n        if (isOpen && !isComment) {\n            level++;\n\n            current = parseTag(tag);\n            if (current.type === 'tag' && options.components[current.name]) {\n                current.type = 'component';\n                inComponent = true;\n            }\n\n            if (!current.voidElement && !inComponent && nextChar && nextChar !== '<') {\n                pushTextNode(current.children, html, level, start, options.ignoreWhitespace);\n            }\n\n            byTag[current.tagName] = current;\n\n            // if we're at root, push new base node\n            if (level === 0) {\n                result.push(current);\n            }\n\n            parent = arr[level - 1];\n\n            if (parent) {\n                parent.children.push(current);\n            }\n\n            arr[level] = current;\n        }\n\n        if (isComment || !isOpen || current.voidElement) {\n            if (!isComment) {\n                level--;\n            }\n            if (!inComponent && nextChar !== '<' && nextChar) {\n                // trailing text node\n                // if we're at the root, push a base text node. otherwise add as\n                // a child to the current node.\n                parent = level === -1 ? result : arr[level].children;\n                pushTextNode(parent, html, level, start, options.ignoreWhitespace);\n            }\n        }\n    });\n\n    // If the \"html\" passed isn't actually html, add it as a text node.\n    if (!result.length && html.length) {\n        pushTextNode(result, html, 0, 0, options.ignoreWhitespace);\n    }\n\n    return result;\n};\n","import { fetchUserOwnedPlaylists } from './library';\nimport { PlaylistDeduplicator, SavedTracksDeduplicator } from './deduplicator';\nimport PlaylistCache from './playlist-cache';\nimport { PlaylistModel } from './types';\nimport SpotifyWebApi, {\n  SpotifyUserType,\n  SpotifyPlaylistType,\n  SpotifyTrackType,\n} from './spotify-api';\n\nconst playlistCache = new PlaylistCache();\n\nconst playlistToPlaylistModel = (\n  playlist: SpotifyPlaylistType\n): PlaylistModel => ({\n  playlist: playlist,\n  duplicates: [],\n  status: '',\n  processed: false,\n});\n\nexport default class {\n  listeners: {};\n  constructor() {\n    this.listeners = {};\n  }\n\n  on(event: string, fn) {\n    this.listeners[event] = this.listeners[event] || [];\n    this.listeners[event].push(fn);\n  }\n\n  dispatch(event: string, params) {\n    const callbacks = this.listeners[event];\n    callbacks.forEach((callback) => callback(params));\n  }\n\n  process = async (api: SpotifyWebApi, user: SpotifyUserType) => {\n    const currentState: {\n      playlists?: Array<PlaylistModel>;\n      savedTracks?: {\n        duplicates?: Array<any>;\n      };\n      toProcess?: number;\n    } = {};\n\n    const dispatch = this.dispatch.bind(this);\n    function onPlaylistProcessed(playlist: PlaylistModel) {\n      playlist.processed = true;\n      var remaining = currentState.toProcess - 1;\n      currentState.toProcess -= 1;\n      if (remaining === 0) {\n        if (global['ga']) {\n          global['ga']('send', 'event', 'spotify-dedup', 'library-processed');\n        }\n        if (global['fbq']) {\n          global['fbq']('trackCustom', 'dedup-library-processed');\n        }\n      }\n      dispatch('updateState', currentState);\n    }\n\n    let playlistsToCheck = [];\n    const ownedPlaylists: Array<SpotifyPlaylistType> = await fetchUserOwnedPlaylists(\n      api,\n      user.id\n    ).catch((e) => {\n      if (global['ga']) {\n        global['ga'](\n          'send',\n          'event',\n          'spotify-dedup',\n          'error-fetching-user-playlists'\n        );\n      }\n      console.error(\"There was an error fetching user's playlists\", e);\n    });\n\n    if (ownedPlaylists) {\n      playlistsToCheck = ownedPlaylists;\n      currentState.playlists = playlistsToCheck.map((p) =>\n        playlistToPlaylistModel(p)\n      );\n      currentState.toProcess =\n        currentState.playlists.length + 1 /* saved tracks */;\n      currentState.savedTracks = {};\n      const savedTracks = await SavedTracksDeduplicator.getTracks(\n        api,\n        api.getMySavedTracks({ limit: 50 })\n      );\n      currentState.savedTracks.duplicates = SavedTracksDeduplicator.findDuplicatedTracks(\n        savedTracks\n      );\n      if (currentState.savedTracks.duplicates.length && global['ga']) {\n        global['ga'](\n          'send',\n          'event',\n          'spotify-dedup',\n          'saved-tracks-found-duplicates'\n        );\n      }\n      currentState.toProcess--;\n\n      this.dispatch('updateState', currentState);\n\n      for (const playlistModel of currentState.playlists) {\n        if (playlistCache.needsCheckForDuplicates(playlistModel.playlist)) {\n          try {\n            const playlistTracks = await PlaylistDeduplicator.getTracks(\n              api,\n              playlistModel.playlist\n            );\n            playlistModel.duplicates = PlaylistDeduplicator.findDuplicatedTracks(\n              playlistTracks\n            );\n            if (playlistModel.duplicates.length === 0) {\n              playlistCache.storePlaylistWithoutDuplicates(\n                playlistModel.playlist\n              );\n            }\n            onPlaylistProcessed(playlistModel);\n          } catch (e) {\n            console.error(\n              'There was an error fetching tracks for playlist',\n              playlistModel.playlist,\n              e\n            );\n            onPlaylistProcessed(playlistModel);\n          }\n        } else {\n          onPlaylistProcessed(playlistModel);\n        }\n      }\n    }\n  };\n}\n","module.exports = require(\"regenerator-runtime\");\n","import promisesForPages from './promiseForPages';\nimport SpotifyWebApi, { SpotifyTrackType, SpotifyPlaylistType, SpotifyPlaylistTrackType, SpotifySavedTrackType } from './spotify-api';\nimport { PlaylistModel } from './types';\n\nclass BaseDeduplicator {\n  async removeDuplicates(model) {\n    throw 'Not implemented';\n  }\n\n  async getTracks() {\n    throw 'Not implemented';\n  }\n\n  static findDuplicatedTracks(tracks: Array<SpotifyTrackType>) {\n    const seenIds: { [key: string]: boolean } = {};\n    const seenNameAndArtist: { [key: string]: Array<number> } = {};\n    const result = tracks.reduce((duplicates, track, index) => {\n      if (track === null) return duplicates;\n      if (track.id === null) return duplicates;\n      let isDuplicate = false;\n      const seenNameAndArtistKey = `${track.name}:${track.artists[0].name}`.toLowerCase();\n      if (track.id in seenIds) {\n        // if the two tracks have the same Spotify ID, they are duplicates\n        isDuplicate = true;\n      } else {\n        // if they have the same name, main artist, and roughly same duration\n        // we consider tem duplicates too\n        if (seenNameAndArtistKey in seenNameAndArtist) {\n          // we check if _any_ of the previous durations is similar to the one we are checking\n          if (\n            seenNameAndArtist[seenNameAndArtistKey].filter(\n              (duration) => Math.abs(duration - track.duration_ms) < 2000\n            ).length !== 0\n          ) {\n            isDuplicate = true;\n          }\n        }\n      }\n      if (isDuplicate) {\n        duplicates.push({\n          index: index,\n          track: track,\n          reason: track.id in seenIds ? 'same-id' : 'same-name-artist',\n        });\n      } else {\n        seenIds[track.id] = true;\n        seenNameAndArtist[seenNameAndArtistKey] =\n          seenNameAndArtist[seenNameAndArtistKey] || [];\n        seenNameAndArtist[seenNameAndArtistKey].push(track.duration_ms);\n      }\n      return duplicates;\n    }, []);\n    return result;\n  }\n}\n\nexport class PlaylistDeduplicator extends BaseDeduplicator {\n  static async getTracks(\n    api: SpotifyWebApi,\n    playlist: SpotifyPlaylistType\n  ): Promise<Array<SpotifyTrackType>> {\n    return new Promise((resolve, reject) => {\n      const tracks = [];\n      promisesForPages(\n        api,\n        api.getGeneric(playlist.tracks.href) // 'https://api.spotify.com/v1/users/11153223185/playlists/0yygtDHfwC7uITHxfrcQsF/tracks'\n      )\n        .then((\n          pagePromises // todo: I'd love to replace this with\n        ) =>\n          // .then(Promise.all)\n          // à la http://www.html5rocks.com/en/tutorials/es6/promises/#toc-transforming-values\n          Promise.all(pagePromises)\n        )\n        .then((pages) => {\n          pages.forEach((page) => {\n            page.items.forEach((item: SpotifyPlaylistTrackType) => {\n              tracks.push(item && item.track);\n            });\n          });\n          resolve(tracks);\n        })\n        .catch(reject);\n    });\n  }\n\n  static async removeDuplicates(api: SpotifyWebApi, playlistModel: PlaylistModel) {\n    return new Promise((resolve, reject) => {\n      if (playlistModel.playlist.id === 'starred') {\n        reject(\n          'It is not possible to delete duplicates from your Starred playlist using this tool since this is not supported in the Spotify Web API. You will need to remove these manually.'\n        );\n      }\n      if (playlistModel.playlist.collaborative) {\n        reject(\n          'It is not possible to delete duplicates from a collaborative playlist using this tool since this is not supported in the Spotify Web API. You will need to remove these manually.'\n        );\n      } else {\n        const tracksToRemove = playlistModel.duplicates\n          .map((d) => ({\n            uri: d.track.linked_from ? d.track.linked_from.uri : d.track.uri,\n            positions: [d.index],\n          }))\n          .reverse(); // reverse so we delete the last ones first\n        const promises = [];\n        do {\n          const chunk = tracksToRemove.splice(0, 100);\n          (function (playlistModel, chunk, api) {\n            promises.push(() =>\n              api.removeTracksFromPlaylist(\n                playlistModel.playlist.owner.id,\n                playlistModel.playlist.id,\n                chunk\n              )\n            );\n          })(playlistModel, chunk, api);\n        } while (tracksToRemove.length > 0);\n\n        promises\n          .reduce(\n            (promise, func) => promise.then(() => func()),\n            Promise.resolve(null)\n          )\n          .then(() => {\n            playlistModel.duplicates = [];\n            resolve();\n          })\n          .catch((e) => {\n            reject(e);\n          });\n      }\n    });\n  }\n}\n\nexport class SavedTracksDeduplicator extends BaseDeduplicator {\n  static async getTracks(\n    api: SpotifyWebApi,\n    initialRequest\n  ): Promise<Array<SpotifyTrackType>> {\n    return new Promise((resolve, reject) => {\n      const tracks = [];\n      promisesForPages(api, initialRequest)\n        .then((\n          pagePromises // todo: I'd love to replace this with\n        ) =>\n          // .then(Promise.all)\n          // à la http://www.html5rocks.com/en/tutorials/es6/promises/#toc-transforming-values\n          Promise.all(pagePromises)\n        )\n        .then((pages) => {\n          pages.forEach((page) => {\n            page.items.forEach((item: SpotifySavedTrackType) => {\n              tracks.push(item.track);\n            });\n          });\n          resolve(tracks);\n        })\n        .catch((e) => {\n          console.error(\n            `There was an error fetching the tracks from playlist ${initialRequest.href}`,\n            e\n          );\n          reject(e);\n        });\n    });\n  }\n\n  static async removeDuplicates(\n    api: SpotifyWebApi,\n    model: {\n      duplicates: Array<{\n        index: number;\n        reason: string;\n        track: SpotifyTrackType;\n      }>;\n    }\n  ) {\n    return new Promise((resolve, reject) => {\n      const tracksToRemove: Array<string> = model.duplicates.map((d) =>\n        d.track.linked_from ? d.track.linked_from.id : d.track.id\n      );\n      do {\n        (async () => {\n          const chunk = tracksToRemove.splice(0, 50);\n          await api.removeFromMySavedTracks(chunk);\n        })();\n      } while (tracksToRemove.length > 0);\n      model.duplicates = [];\n      resolve();\n    });\n  }\n}\n","module.exports = {\n    parse: require('./lib/parse'),\n    stringify: require('./lib/stringify')\n};\n","var attrRE = /([\\w-]+)|=|(['\"])([.\\s\\S]*?)\\2/g;\nvar voidElements = require('void-elements');\n\nmodule.exports = function (tag) {\n    var i = 0;\n    var key;\n    var expectingValueAfterEquals = true;\n    var res = {\n        type: 'tag',\n        name: '',\n        voidElement: false,\n        attrs: {},\n        children: []\n    };\n\n    tag.replace(attrRE, function (match) {\n        if (match === '=') {\n            expectingValueAfterEquals = true;\n            i++;\n            return;\n        }\n\n        if (!expectingValueAfterEquals) {\n            if (key) {\n                res.attrs[key] = key; // boolean attribute\n            }\n            key=match;\n        } else {\n            if (i === 0) {\n                if (voidElements[match] || tag.charAt(tag.length - 2) === '/') {\n                    res.voidElement = true;\n                }\n                res.name = match;\n            } else {\n                res.attrs[key] = match.replace(/^['\"]|['\"]$/g, '');\n                key=undefined;\n            }\n        }\n        i++;\n        expectingValueAfterEquals = false;\n    });\n\n    return res;\n};\n"],"sourceRoot":""}